<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Landbot | Convert a Landing Page into a Chatbot</title>
    <script src="https://code.jquery.com/jquery-3.5.1.js">
    </script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
    <link href="main.css" rel="stylesheet">
</head>

<body class="container">
    <div class="row">
        <div class="col-md-12 search-movie">
            <input id="search" type="text" placeholder="Search Movie">
            <div id="exampleModal" class="modal" tabindex="-1">
                <div class="modal-dialog modal-fullscreen">
                    <div class="modal-content">
                        <div class="modal-body">
                            <iframe id="video-box" src="" allowfullscreen="true" sandbox="allow-scripts allow-forms allow-pointer-lock allow-same-origin" allow="autoplay" autoplay="false"></iframe>
                        </div>
                        <div class="modal-footer">
                            <button type="button" onclick="stopVideo()" class="btn btn-danger mx-auto" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-12 search-buttons">
            <button class="btn btn-primary" onclick="newFunc()">Fetch Movie</button>
        </div>
    </div>
    <div class="row" id="movies"></div>
    <script>
        var moviename;
        var moviedate;
        var movielink;
        var searchName;
        var id;
        var elem = document.getElementById("video-box");

        function newFunc() {
            searchName = document.getElementById("search").value;
            var getJson = "https://www.omdbapi.com/?apikey=6eb9b278&s=" + searchName + "type=movie";
            console.log(getJson);

            function omdbCall() {
                $.getJSON('https://www.omdbapi.com/?apikey=6eb9b278&s=' + searchName).then(function(response) {
                    let movies = response.Search;
                    console.log(movies);
                    let output = '';
                    $.each(movies, (index, movie) => {
                        output += `
                        <div class="col-12 col-sm-6 col-md-4 col-lg-3" class="movie">
                            <div class="text-center">
                                <div class="movie-image">
                                    <img src="${movie.Poster}">
                                </div>
                                <h5>${movie.Title}</h5>
                                <button id="${movie.imdbID}" data-bs-toggle="modal" data-bs-target="#exampleModal" onclick="movieSelected()" class="btn btn-primary href="#">Stream Movie</button>
                            </div>
                        </div>    
                        `;
                    });
                    $('#movies').html(output);
                });
            }
            omdbCall();
        }

        function movieSelected() {
            /*console.log(x);
            x = x.toString();
            console.log(x);*/
            var id = event.srcElement.id;
            movielink = "https://www.2embed.ru/embed/imdb/movie?id=" + id;
            document.getElementById("video-box").src = movielink;
            console.log(movielink);

            //fullscreen request
            if (elem.requestFullscreen) {
                elem.requestFullscreen();
            } else if (elem.webkitRequestFullscreen) {
                /* Safari */
                elem.webkitRequestFullscreen();
            } else if (elem.msRequestFullscreen) {
                /* IE11 */
                elem.msRequestFullscreen();
            }

            var change = document.getElementById("PlayVideo");
            //Get the saved time from local storage
            var PausedTime = localStorage.getItem('CaptureTime');

            if (isPlaying) {
                vid.pause();

                //Storing the paused time to local storage
                localStorage.setItem('CaptureTime', getCurTime());

                change.innerHTML = "Play";
            } else {
                vid.currentTime = PausedTime;
                vid.play();
                change.innerHTML = "Pause";
            }

            isPlaying = !isPlaying;
        }

        function myFunc() {
            moviename = document.getElementById("movieName").value;
            moviedate = document.getElementById("movieDate").value;
            movielink = "https://www.2embed.ru/embed/title/movie?title=" + moviename + "&year=" + moviedate;
            document.getElementById("video-box").src = movielink;
            document.getElementsByTagName('video').autoplay = "1";
            console.log(movielink);

            //fullscreen request
            if (elem.requestFullscreen) {
                elem.requestFullscreen();
            } else if (elem.webkitRequestFullscreen) {
                /* Safari */
                elem.webkitRequestFullscreen();
            } else if (elem.msRequestFullscreen) {
                /* IE11 */
                elem.msRequestFullscreen();
            }
        }

        var vid = document.getElementById("video-box");

        function getCurTime() {
            return vid.currentTime;
        }

        var isPlaying = false;
        var PausedTime;

        function PlayVideo() {
            var change = document.getElementById("PlayVideo");
            //Get the saved time from local storage
            var PausedTime = localStorage.getItem('CaptureTime');

            if (isPlaying) {
                vid.pause();

                //Storing the paused time to local storage
                localStorage.setItem('CaptureTime', getCurTime());

                change.innerHTML = "Play";
            } else {
                vid.currentTime = PausedTime;
                vid.play();
                change.innerHTML = "Pause";
            }

            isPlaying = !isPlaying;
        }
        
        function stopVideo() {
            document.getElementById("video-box").src = "";
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js" integrity="sha384-eMNCOe7tC1doHpGoWe/6oMVemdAVTMs2xqW4mwXrXsW0L84Iytr2wi5v2QjrP/xp" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.min.js" integrity="sha384-cn7l7gDp0eyniUwwAZgrzD06kc/tftFf19TOAs2zVinnD/C7E91j9yyk5//jjpt/" crossorigin="anonymous"></script>
</body></html>


    